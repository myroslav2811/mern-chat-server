(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{110:function(e,t,a){e.exports=a(196)},115:function(e,t,a){},118:function(e,t,a){},164:function(e,t){},168:function(e,t,a){},172:function(e,t,a){},173:function(e,t,a){},189:function(e,t,a){},190:function(e,t,a){},191:function(e,t,a){},192:function(e,t,a){},193:function(e,t,a){},196:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(7),s=a.n(c),o=(a(115),a(11)),i=a(26),l=a(226),u=a(227),d=a(54),m=(a(118),a(15)),p=a(6),E=a(29),f=a.n(E),g={setToken:function(e){localStorage.setItem("accessToken",e.accessToken),localStorage.setItem("refreshToken",e.refreshToken)},getAccessToken:function(){return localStorage.getItem("accessToken")},getRefreshToken:function(){return localStorage.getItem("refreshToken")},clearToken:function(){localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken")}},h=a(100),S=a.n(h)()("",{query:"auth_token="+g.getAccessToken()}),y=["/signin"];f.a.defaults.baseURL="/api",f.a.defaults.headers.common.Authorization="Bearer "+g.getAccessToken(),f.a.interceptors.response.use((function(e){return e}),(function(e){var t=e.config;return y.includes(t.url)||401!==e.response.status||t._retry?Promise.reject(e):(t._retry=!0,f.a.post("/refresh-tokens",{refreshToken:g.getRefreshToken()}).then((function(e){if(201===e.status)return g.setToken(e.data),f.a.defaults.headers.common.Authorization="Bearer "+g.getAccessToken(),S.close(),S.io.opts.query="auth_token="+g.getAccessToken(),S.connect(),f()(t)})))}));var b=f.a,v=a(36),O=a.n(v),T=function(e){var t=O()().dayOfYear()-O()(e).dayOfYear();return O()().diff(e,"months")>12?"DD MMM YYYY HH:mm":O()().diff(e,"days")>6?"DD MMM HH:mm":t>1?"ddd HH:mm":t>0?"[Yestarday at] HH:mm":"HH:mm"},_=function(e,t){var a=t.type,n=t.payload;switch(a){case"SET_IS_AUTHENTICATED":return Object(p.a)(Object(p.a)({},e),{},{isAuthenticated:n});case"SET_IS_LOADING":return Object(p.a)(Object(p.a)({},e),{},{isLoading:n});case"SET_USER":return Object(p.a)(Object(p.a)({},e),{},{user:n});case"SET_SUCCESS_SIGNUP":return Object(p.a)(Object(p.a)({},e),{},{successSignUp:n});case"SET_SIGNUP_ERROR":return Object(p.a)(Object(p.a)({},e),{},{signUpError:n});case"RESET":return Object(p.a)(Object(p.a)({},j),{},{isLoading:!1});case"SET_SIGNING_ERROR":return Object(p.a)(Object(p.a)({},e),{},{signInError:n});default:return e}},j={isAuthenticated:!1,isLoading:!0,user:null,successSignUp:!1,signUpError:"",signInError:""},I=r.a.createContext({}),N=function(e){var t=e.children,a=Object(n.useReducer)(_,j),c=Object(m.a)(a,2),s=c[0],o=c[1],i=s.isAuthenticated,l=s.isLoading,u=s.user,d=s.successSignUp,E=s.signUpError,f=s.signInError;Object(n.useEffect)((function(){h()}),[]);var h=function(){return b.get("/check-auth").then((function(e){return e.data})).then((function(e){return o({type:"SET_USER",payload:e})})).then((function(e){return o({type:"SET_IS_AUTHENTICATED",payload:!0})})).catch((function(e){return o({type:"SET_IS_AUTHENTICATED",payload:!1})})).then((function(e){return o({type:"SET_IS_LOADING",payload:!1})}))};return r.a.createElement(I.Provider,{value:{isAuthenticated:i,isLoading:l,user:u,successSignUp:d,signUpError:E,signInError:f,resetSuccessSignUp:function(){o({type:"SET_SUCCESS_SIGNUP",payload:!1})},resetErrors:function(){o({type:"SET_SIGNUP_ERROR",payload:""}),o({type:"SET_SIGNING_ERROR",payload:""})},login:function(e){return(t=e,b.post("/signin",t).then((function(e){return g.setToken(e.data.tokens),b.defaults.headers.common.Authorization="Bearer "+e.data.tokens.accessToken,e.data.user}))).then((function(e){o({type:"SET_USER",payload:e}),o({type:"SET_IS_AUTHENTICATED",payload:!0})})).catch((function(e){o({type:"SET_SIGNING_ERROR",payload:e.response.data.message}),o({type:"SET_IS_AUTHENTICATED",payload:!1})}));var t},logout:function(){return b.post("/logout").then(g.clearToken()).then((function(e){return o({type:"SET_IS_AUTHENTICATED",payload:!1})})).then((function(e){return o({type:"RESET"})}))},signUp:function(e){return(t=e,b.post("/signup",Object(p.a)(Object(p.a)({},t),{},{avatar:"hsl("+360*Math.random()+","+(10+70*Math.random())+"%,"+(55+10*Math.random())+"%)"}))).then((function(e){return o({type:"SET_SUCCESS_SIGNUP",payload:!0})})).catch((function(e){return o({type:"SET_SIGNUP_ERROR",payload:e.response.data.message})}));var t}}},t)},w=a(222),A=(a(168),function(e){var t=e.size,a=void 0===t?"40px":t;return r.a.createElement("div",{className:"spinnerStyle"},r.a.createElement(w.a,{size:a}))}),R=function(e){var t=Object(n.useContext)(I),a=t.signInError,c=t.resetErrors,s=e.values,o=e.touched,d=e.errors,m=e.handleChange,p=e.handleBlur,E=e.handleSubmit;return Object(n.useEffect)((function(){c()}),[]),r.a.createElement("div",{className:"formWrapper"},r.a.createElement("form",{noValidate:!0,onSubmit:E},r.a.createElement("h2",{className:"headStyle"},"Sign In"),r.a.createElement("div",{className:"inputStyle"},r.a.createElement(l.a,{name:"username",type:"text",label:"Username",value:s.username,onChange:m,onBlur:p,error:!!d.username&&!!o.username,helperText:d.username&&o.username?d.username:null,fullWidth:!0,variant:"outlined"})),r.a.createElement("div",{className:"inputStyle"},r.a.createElement(l.a,{name:"password",type:"password",label:"Password",value:s.password,onChange:m,onBlur:p,error:!!d.password&&!!o.password,helperText:d.password&&o.password?d.password:null,fullWidth:!0,variant:"outlined"})),r.a.createElement("div",{className:"inputStyle"},r.a.createElement(u.a,{fullWidth:!0,variant:"contained",color:"primary",type:"submit"},"Sign In")),r.a.createElement("p",{className:"invalidDataStyle"},a),r.a.createElement("div",{className:"inputStyle"},r.a.createElement(i.b,{to:"/signup",className:"linkStyle"},"Or create new account"))))},x=function(){var e=Object(n.useContext)(I),t=e.isAuthenticated,a=e.isLoading,c=e.login,s=Object(o.f)();return t&&s.push("/"),a?r.a.createElement(A,null):r.a.createElement(d.a,{component:R,validate:function(e){var t={};return e.username||(t.username="Required"),e.password||(t.password="Required"),t},initialValues:{username:"",password:""},onSubmit:function(e){c(e)}})},C={width:"600px",backgroundColor:"#fff",padding:"50px",borderRadius:"5px",margin:"100px auto",textAlign:"center",color:"#303030"},D=function(){return r.a.createElement("div",{style:C},r.a.createElement("h3",null,"Your account succefuly created!"),r.a.createElement("p",null,"You will be automatically redirected to the login page."))},k=(a(172),function(e){var t=Object(o.f)(),a=Object(n.useContext)(I),c=a.successSignUp,s=a.signUpError,d=a.resetErrors,m=a.resetSuccessSignUp,p=e.values,E=e.touched,f=e.errors,g=e.handleChange,h=e.handleBlur,S=e.handleSubmit;return Object(n.useEffect)((function(){d()}),[]),c?(setTimeout((function(){t.push("/signin"),m()}),2e3),r.a.createElement(D,null)):r.a.createElement("div",{className:"formWrapper"},r.a.createElement("form",{noValidate:!0,onSubmit:S},r.a.createElement("h2",{className:"headStyle"},"Sign Up"),r.a.createElement("div",{className:"inputStyle"},r.a.createElement(l.a,{name:"username",type:"text",label:"Username",value:p.username,onChange:g,onBlur:h,error:!!f.username&&!!E.username,helperText:f.username&&E.username?f.username:null,fullWidth:!0,variant:"outlined"})),r.a.createElement("div",{className:"inputStyle"},r.a.createElement(l.a,{name:"password",type:"password",label:"Password",value:p.password,onChange:g,onBlur:h,error:!!E.password&&!!f.password,helperText:E.password&&f.password?f.password:null,fullWidth:!0,variant:"outlined"})),r.a.createElement("div",{className:"inputStyle"},r.a.createElement(l.a,{name:"passwordRepeat",type:"password",label:"Repeat password",value:p.passwordRepeat,onChange:g,onBlur:h,error:!!f.passwordRepeat&&!!E.passwordRepeat,helperText:f.passwordRepeat&&E.passwordRepeat?f.passwordRepeat:null,fullWidth:!0,variant:"outlined"})),r.a.createElement("div",{className:"inputStyle"},r.a.createElement(u.a,{fullWidth:!0,variant:"contained",color:"primary",type:"submit"},"Sign Up")),r.a.createElement("p",{className:"invalidDataStyle"},!c&&s),r.a.createElement("div",{className:"inputStyle"},r.a.createElement(i.b,{to:"/signin",className:"linkStyle"},"Or sign in"))))}),L=function(){var e=Object(n.useContext)(I),t=e.isAuthenticated,a=e.isLoading,c=e.signUp,s=Object(o.f)();return t&&s.push("/"),a?r.a.createElement(A,null):r.a.createElement(d.a,{component:k,validate:function(e){var t={};return e.username||(t.username="Required"),e.username.length>20&&(t.username="username should contain no more than 20 characters"),e.password?e.password.length<6&&(t.password="password should contain at least 6 characters"):t.password="Required",e.passwordRepeat?e.passwordRepeat!==e.password&&(t.passwordRepeat="Passwords do not match"):t.passwordRepeat="Required",t},initialValues:{username:"",password:"",passwordRepeat:""},onSubmit:function(e){c(e)}})},U=a(105),G=function(e){var t=e.component,a=Object(U.a)(e,["component"]),c=Object(n.useContext)(I),s=c.isAuthenticated,i=c.isLoading;return r.a.createElement(o.b,Object.assign({},a,{render:function(e){return i?r.a.createElement(A,null):s?r.a.createElement(t,e):r.a.createElement(o.a,{to:"/signin"})}}))},H=(a(173),a(52)),M=(a(189),a(53)),P=a.n(M),W=a(34),B=a.n(W),z=(a(190),a(28)),Y=function(e,t){var a=new RegExp(e,"i");return t.filter((function(e){return a.test(e.to.username)}))},q=function(e,t){var a=t.type,n=t.payload;switch(a){case"SET_DIALOGS":return Object(p.a)(Object(p.a)({},e),{},{dialogs:n});case"SET_DIALOG":return Object(p.a)(Object(p.a)({},e),{},{dialog:n});case"SET_RECEIVER":return Object(p.a)(Object(p.a)({},e),{},{receiver:n});case"SET_FILTERED":return Object(p.a)(Object(p.a)({},e),{},{filtered:n});case"SET_IS_LOADING":return Object(p.a)(Object(p.a)({},e),{},{isLoading:n});case"ADD_DIALOG":var r=e.dialogs.filter((function(e){return e._id!==n._id})),c=e.filtered.filter((function(e){return e._id!==n._id}));return Object(p.a)(Object(p.a)({},e),{},{dialogs:[n].concat(Object(z.a)(r)),filtered:[n].concat(Object(z.a)(c))});default:return e}},V={dialogs:[],dialog:null,receiver:null,filtered:[],isLoading:!0},F=Object(n.createContext)(),J=function(e){var t=e.children,a=Object(n.useReducer)(q,V),c=Object(m.a)(a,2),s=c[0],o=c[1],i=s.dialogs,l=s.filtered,u=s.dialog,d=s.receiver,p=s.isLoading;return r.a.createElement(F.Provider,{value:{getDialogs:function(){o({type:"SET_IS_LOADING",payload:!0}),b.get("/dialogs").then((function(e){return e.data})).then((function(e){o({type:"SET_DIALOGS",payload:e}),o({type:"SET_FILTERED",payload:e})})).then((function(e){return o({type:"SET_IS_LOADING",payload:!1})})).catch((function(e){return o({type:"SET_IS_LOADING",payload:!1})}))},updateDialog:function(e){o({type:"ADD_DIALOG",payload:e})},chooseDialog:function(e){u&&S.emit("leave",u._id),o({type:"SET_DIALOG",payload:e}),o({type:"SET_RECEIVER",payload:e.to}),S.emit("join",e._id)},createDialog:function(e){(function(e,t,a,n){return t&&S.emit("leave",t._id),b.post("/create-dialog",{id:e}).then((function(e){var t=e.data,r=a.filter((function(e){return e._id!==t._id})),c=n.filter((function(e){return e._id!==t._id}));return S.emit("join",t._id),[t,[t].concat(Object(z.a)(r)),[t].concat(Object(z.a)(c))]}))})(e,u,i,l).then((function(e){var t=Object(m.a)(e,3),a=t[0],n=t[1],r=t[2];o({type:"SET_DIALOGS",payload:n}),o({type:"SET_FILTERED",payload:r}),o({type:"SET_DIALOG",payload:a}),o({type:"SET_RECEIVER",payload:a.to})}))},dialogs:i,dialog:u,filtered:l,filterDialogs:function(e){o({type:"SET_FILTERED",payload:Y(e,i)})},receiver:d,isLoading:p}},t)},$=function(e){var t=e.item,a=e.userId,c=e.username,s=e.lastMessage,o=e.updatedAt,i=e.isSearching,l=e.avatar,u=Object(n.useContext)(F),d=u.createDialog,m=u.chooseDialog,p=u.dialog,E=B()("contact",{selectedContact:!i&&p&&p._id===t._id});return r.a.createElement("div",{className:E,onClick:i?function(){d(a)}:function(){m(t)}},r.a.createElement("div",{className:"contactAvatar"},r.a.createElement("p",{className:"contactAvatar",style:{backgroundColor:l}},c[0])),r.a.createElement("div",{className:"contactContent"},i?r.a.createElement("p",{className:"contactUsername"},c):r.a.createElement(r.a.Fragment,null,r.a.createElement("p",{className:"contactUsername"},c),r.a.createElement("p",{className:"lastMessage"},s?s.text:"No messages..."),r.a.createElement("p",{className:"contactDate"},r.a.createElement(P.a,{date:o,fromNowDuring:3e5,format:T(o)})))))},K=function(e){var t=e.text;return r.a.createElement("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",margin:"0 auto",opacity:"0.6",fontSize:"20px",padding:"30px 20px",textAlign:"center"}},t)},Q=function(){var e=Object(n.useState)(""),t=Object(m.a)(e,2),a=t[0],c=t[1],s=Object(n.useState)(null),o=Object(m.a)(s,2),i=o[0],d=o[1],p=Object(n.useState)(!1),E=Object(m.a)(p,2),f=E[0],g=E[1],h=Object(n.useContext)(F),S=h.getDialogs,y=h.filtered,v=h.filterDialogs,O=h.isLoading,T=Object(n.useContext)(I),_=T.user,j=T.logout,N=function(e,t){var a=Object(n.useState)(e),r=Object(m.a)(a,2),c=r[0],s=r[1];return Object(n.useEffect)((function(){var a=setTimeout((function(){s(e)}),t);return function(){clearTimeout(a)}}),[e]),c}(a,500);Object(n.useEffect)((function(){S()}),[_]),Object(n.useEffect)((function(){var e;N&&a.trim()?(g(!0),(e=N,b.post("/search-contacts",{username:e}).then((function(e){return e.data}))).then((function(e){g(!1),d(e)}))):d(null)}),[N]);return r.a.createElement("div",{className:"contactList"},r.a.createElement("div",{className:"headerListContainer"},r.a.createElement("div",{className:"greeting"},r.a.createElement("h3",null,_?_.username:null),r.a.createElement(u.a,{onClick:j},"Log out")),r.a.createElement("div",{className:"searchPanel"},r.a.createElement(l.a,{type:"text",label:"Search",value:a,onChange:function(e){c(e.target.value),v(e.target.value.trim())},fullWidth:!0,variant:"outlined"}))),r.a.createElement("div",{className:"scrollbarContainer"},O?r.a.createElement(A,null):r.a.createElement(H.Scrollbars,{autoHide:!0,autoHideTimeout:1e3,autoHideDuration:200,renderTrackHorizontal:function(e){return r.a.createElement("div",Object.assign({},e,{style:{display:"none"}}))}},r.a.createElement("div",null,r.a.createElement("p",{className:"listHeader"},"Dialogs"),y.length?y.map((function(e){return r.a.createElement($,{updatedAt:e.updatedAt,username:e.to.username,id:e._id,lastMessage:e.lastMessage,key:e._id,item:e,avatar:e.to.avatar})})):r.a.createElement(K,{text:"There are no contacts. Find user using the field above and start messaging"})),i?r.a.createElement("div",null,r.a.createElement("p",{className:"listHeader"},"Global search result"),f?r.a.createElement(A,null):i.length?i.map((function(e){return r.a.createElement($,{username:e.username,userId:e._id,avatar:e.avatar,isSearching:!0,key:e._id})})):r.a.createElement(K,{text:"There are no contacts"})):null)))},X=a(104),Z=a.n(X),ee=function(e,t){var a=t.type,n=t.payload;switch(a){case"GET_MESSAGES":return Object(p.a)(Object(p.a)({},e),{},{messages:n});case"PUSH_NEW_MESSAGE":return Object(p.a)(Object(p.a)({},e),{},{messages:[].concat(Object(z.a)(e.messages),[n])});case"SET_IS_LOADING":return Object(p.a)(Object(p.a)({},e),{},{isLoading:n});default:return e}},te={messages:[],isLoading:!1},ae=Object(n.createContext)(),ne=function(e){var t=e.children,a=Object(n.useReducer)(ee,te),c=Object(m.a)(a,2),s=c[0],o=c[1],i=s.messages,l=s.isLoading;return r.a.createElement(ae.Provider,{value:{messages:i,isLoading:l,getMessages:function(e){o({type:"SET_IS_LOADING",payload:!0}),function(e){return b.get("/messages/".concat(e,"/")).then((function(e){return e.data}))}(e).then((function(e){o({type:"GET_MESSAGES",payload:e}),o({type:"SET_IS_LOADING",payload:!1})})).catch((function(){o({type:"SET_IS_LOADING",payload:!1})}))},pushNewMessage:function(e){o({type:"PUSH_NEW_MESSAGE",payload:e})}}},t)},re=(a(191),function(e){var t=e.text,a=e.createdAt,c=e.author,s=Object(n.useContext)(I).user,o=B()("message",{myMessage:s&&s._id===c});return r.a.createElement("p",{className:o},r.a.createElement("span",{className:"messageText"},t),r.a.createElement("span",{className:"messageDate"},r.a.createElement(P.a,{date:a,format:T(a)})))}),ce=(a(192),function(){var e=Object(n.useContext)(ae),t=e.messages,a=e.isLoading,c=e.getMessages,s=Object(n.useContext)(F).dialog,o=Object(n.useState)(!0),i=Object(m.a)(o,2),l=i[0],u=i[1],d=Object(n.useRef)();Object(n.useEffect)((function(){u(!0)}),[t]),Object(n.useEffect)((function(){s&&c(s._id)}),[s]);var p=B()("messagesContainer",{emptyContainer:!t.length});return a?r.a.createElement("div",{style:{flexGrow:"1"}},r.a.createElement(A,null)):r.a.createElement(H.Scrollbars,{style:{display:"flex"},autoHide:!0,autoHideTimeout:1e3,autoHideDuration:200,ref:d,onUpdate:function(e){l&&(d.current.scrollToBottom(),u(!1))},renderTrackHorizontal:function(e){return r.a.createElement("div",Object.assign({},e,{style:{display:"none"}}))}},r.a.createElement("div",{className:p},t.length?t.map((function(e){return r.a.createElement(re,{key:e._id,text:e.text,author:e.author,createdAt:e.createdAt})})):r.a.createElement(K,{text:"There are no messages yet"})))}),se=Object(n.createContext)(),oe=function(e){var t=e.children,a=Object(n.useContext)(ae).pushNewMessage,c=Object(n.useContext)(F).updateDialog;return Object(n.useEffect)((function(){S.on("updateDialog",c),S.on("newMessage",a)}),[]),r.a.createElement(se.Provider,{value:{socket:S}},t)},ie=(a(193),function(){var e=Object(n.useState)(""),t=Object(m.a)(e,2),a=t[0],c=t[1],s=Object(n.useContext)(F),o=s.dialog,i=s.receiver,d=Object(n.useContext)(I).user,p=Object(n.useContext)(se).socket;return o?r.a.createElement("div",{className:"dialog"},r.a.createElement("div",{className:"dialogHeader"},r.a.createElement("p",null,i&&i.username)),r.a.createElement(ce,null),r.a.createElement("div",{className:"dialogInput"},r.a.createElement("form",{onSubmit:function(e){if(e.preventDefault(),a.trim()){var t={dialog:o._id,text:a.trim(),author:d._id,to:i._id};p.emit("createMessage",t)}c("")}},r.a.createElement(l.a,{type:"text",value:a,placeholder:"Write message here...",onChange:function(e){c(e.target.value)},fullWidth:!0,variant:"outlined"}),r.a.createElement(u.a,{type:"submit"},r.a.createElement(Z.a,{fontSize:"large",color:"primary"}))))):r.a.createElement(K,{text:"Choose dialog to start messaging"})}),le=function(){return r.a.createElement("div",{className:"container"},r.a.createElement(Q,null),r.a.createElement(ie,null))},ue=function(){return r.a.createElement(N,null,r.a.createElement(J,null,r.a.createElement(ne,null,r.a.createElement(oe,null,r.a.createElement(o.b,{component:x,path:"/signin",exact:!0}),r.a.createElement(o.b,{component:L,path:"/signup",exact:!0}),r.a.createElement(G,{component:le,path:"/",exact:!0})))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(i.a,null,r.a.createElement(ue,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[110,1,2]]]);
//# sourceMappingURL=main.74a1b216.chunk.js.map